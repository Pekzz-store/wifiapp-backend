# ===============================
# Railway Laravel + Vite Deploy
# ===============================

[phases.setup]
nixPkgs = [
  # ✅ PHP
  "php81",

  # ✅ Composer
  "php81Packages.composer",

  # ✅ Node.js + npm (buat Vite/Tailwind)
  "nodejs_18",

  # ✅ PHP extensions wajib Laravel
  "php81Extensions.mbstring",
  "php81Extensions.bcmath",
  "php81Extensions.xml",
  "php81Extensions.curl",
  "php81Extensions.openssl",
  "php81Extensions.pdo",
  "php81Extensions.pdo_mysql"
]

# ===============================
# BUILD PHASE
# ===============================
[phases.build]
cmds = [
  # Install Laravel dependencies
  "composer install --no-dev --optimize-autoloader",

  # Cache Laravel biar cepat
  "php artisan config:cache",
  "php artisan route:cache",

  # Install frontend dependencies
  "npm install",

  # Build Vite assets
  "npm run build",

  # Jalankan migration otomatis
  "php artisan migrate --force"
]

# ===============================
# START COMMAND
# ===============================
[start]
cmd = "php -S 0.0.0.0:$PORT -t public"